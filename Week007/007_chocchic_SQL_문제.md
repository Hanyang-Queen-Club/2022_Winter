-- 자동차 대여 기록에서 장기/단기 대여 구분하기
SELECT HISTORY_ID, CAR_ID,	TO_CHAR(START_DATE, 'YYYY-MM-DD'), TO_CHAR(END_DATE, 'YYYY-MM-DD'), 
    CASE WHEN END_DATE - START_DATE >= 29 THEN '장기 대여'
    ELSE '단기 대여'
    END AS RENT_TYPE
FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY 
WHERE EXTRACT(YEAR FROM START_DATE) = '2022'
    AND EXTRACT(MONTH FROM START_DATE) = '9'
ORDER BY HISTORY_ID DESC
;
** 출력할 문구의 띄어쓰기 조심 ** 

-- DATETIME에서 DATE로 형 변환
SELECT ANIMAL_ID, NAME, TO_CHAR(DATETIME, 'YYYY-MM-DD')
FROM ANIMAL_INS
ORDER BY ANIMAL_ID
;

-- 카테고리 별 상품 개수 구하기
SELECT SUBSTR(PRODUCT_CODE, 1,2) AS CATEGORY, COUNT(*) AS	PRODUCTS
FROM PRODUCT
GROUP BY SUBSTR(PRODUCT_CODE, 1,2)
ORDER BY SUBSTR(PRODUCT_CODE, 1,2) ASC
;

-- 오랜 기간 보호한 동물(2)
SELECT ANIMAL_ID, NAME
FROM (SELECT  I.ANIMAL_ID, I.NAME
    FROM ANIMAL_INS I, ANIMAL_OUTS O
    WHERE I.ANIMAL_ID = O.ANIMAL_ID
    ORDER BY (O.DATETIME - I.DATETIME) DESC
)
WHERE  ROWNUM <= 2
;

-- 년, 월, 성별 별 상품 구매 회원 수 구하기
SELECT YEAR, MONTH, GENDER, COUNT(*) AS USERS
FROM ( SELECT DISTINCT U.USER_ID, EXTRACT(YEAR FROM SALES_DATE) AS YEAR, EXTRACT(MONTH FROM SALES_DATE) AS MONTH, U.GENDER
	FROM USER_INFO U, ONLINE_SALE O 
        WHERE GENDER IN (0,1)
        AND U.USER_ID = O.USER_ID
      )
GROUP BY YEAR, MONTH, GENDER
ORDER BY YEAR ASC, MONTH ASC, GENDER ASC
;

--주문량이 많은 아이스크림들 조회하기
SELECT FLAVOR
FROM (SELECT FLAVOR, SUM(TOTAL_ORDER) AS TOTAL_ORDER
    FROM (SELECT FLAVOR, TOTAL_ORDER
        FROM JULY
        UNION ALL
     SELECT FLAVOR, TOTAL_ORDER
        FROM FIRST_HALF
        )
    GROUP BY FLAVOR
    ORDER BY TOTAL_ORDER DESC
    )
WHERE ROWNUM <= 3
;

-- 5월 식품들의 총매출 조회하기
SELECT PRODUCT_ID, PRODUCT_NAME, SUM(SALES) AS TOTAL_SALES
FROM (SELECT P.PRODUCT_ID, P.PRODUCT_NAME, TO_NUMBER(O.AMOUNT * P.PRICE) AS SALES
FROM FOOD_PRODUCT P, FOOD_ORDER O
WHERE EXTRACT(YEAR FROM O.PRODUCE_DATE) = '2022' AND EXTRACT(MONTH FROM O.PRODUCE_DATE)  = '5'
AND P.PRODUCT_ID = O.PRODUCT_ID
)
GROUP BY PRODUCT_ID, PRODUCT_NAME
ORDER BY TOTAL_SALES DESC, PRODUCT_ID ASC
;


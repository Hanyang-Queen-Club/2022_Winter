#### 성분으로 구분한 아이스크림 총 주문량
SELECT I.INGREDIENT_TYPE, SUM(F.TOTAL_ORDER) AS TOTAL_ORDER
FROM FIRST_HALF F, ICECREAM_INFO I
WHERE F.FLAVOR = I.FLAVOR
GROUP BY INGREDIENT_TYPE
ORDER BY TOTAL_ORDER
;

#### 헤비 유저가 소유한 장소
SELECT * 
FROM PLACES
WHERE HOST_ID IN (
    SELECT HOST_ID FROM PLACES GROUP BY HOST_ID HAVING COUNT(*) > 1  
)
ORDER BY ID
;

#### 우유와 요거트가 담긴 장바구니
SELECT CART_ID 
FROM CART_PRODUCTS
WHERE CART_ID IN (
    SELECT CART_ID 
    FROM CART_PRODUCTS 
    WHERE NAME = 'Milk'
)
AND CART_ID IN (SELECT CART_ID FROM CART_PRODUCTS WHERE NAME = 'Yogurt')
GROUP BY CART_ID
ORDER BY CART_ID
;

#### 재구매가 일어난 상품과 회원 리스트 구하기
SELECT USER_ID, PRODUCT_ID
FROM ONLINE_SALE
GROUP BY USER_ID, PRODUCT_ID
HAVING COUNT(*) > 1
ORDER BY USER_ID ASC, PRODUCT_ID DESC;

#### 서울에 위치한 식당 목록 출력하기
SELECT I.REST_ID, I.REST_NAME, I.FOOD_TYPE, I.FAVORITES, I.ADDRESS, ROUND(AVG(R.REVIEW_SCORE),2) AS SCORE
FROM REST_INFO I, REST_REVIEW R
WHERE I.REST_ID = R.REST_ID
AND I.ADDRESS LIKE '서울%'
GROUP BY I.REST_ID, I.REST_NAME, I.FOOD_TYPE, I.FAVORITES, I.ADDRESS
ORDER BY SCORE DESC, FAVORITES DESC;

#### 오프라인/온라인 판매 데이터 통합하기
SELECT TO_CHAR(SALES_DATE, 'YYYY-MM-DD') AS SALES_DATE, PRODUCT_ID, USER_ID, SALES_AMOUNT
FROM (
        SELECT *
        FROM ONLINE_SALE 
        WHERE TO_CHAR(SALES_DATE, 'YYYYMMDD') BETWEEN '20220301' AND '20220331'
        UNION ALL 
        SELECT OFFLINE_SALE_ID AS ONLINE_SALE_ID, NULL AS USER_ID, PRODUCT_ID, SALES_AMOUNT, SALES_DATE 
        FROM OFFLINE_SALE 
        WHERE TO_CHAR(SALES_DATE, 'YYYYMMDD') BETWEEN '20220301' AND '20220331'
)
ORDER BY SALES_DATE ASC, PRODUCT_ID ASC, USER_ID ASC;
